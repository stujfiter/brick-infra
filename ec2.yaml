Parameters:
  PostgresPwd:
    Type: String
Resources:
  MyEC2Instance:
    Type: "AWS::EC2::Instance"
    Properties: 
      ImageId: "ami-07b4f3c02c7f83d59"
      InstanceType: t2.micro
      KeyName: korey-earl-aws
      SecurityGroups:
      - launch-wizard-2
      UserData:
        Fn::Base64:
          !Sub |
            #!/bin/bash -xe
            sudo apt-get update
            # Install AWS CLI
            sudo apt-get install python3-pip -y
            pip3 install awscli --upgrade
            # Install Docker
            sudo apt-get install docker.io -y
            sudo systemctl start docker
            sudo systemctl enable docker
            # Install Postgresql
            sudo apt-get install postgresql -y
            echo "host all all 0.0.0.0/0 md5" | sudo tee -a /etc/postgresql/10/main/pg_hba.conf
            sudo -u postgres psql -c "ALTER USER postgres PASSWORD '${PostgresPwd}';"
